<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ixercise</title>
    <!-- 引入bootstarp跟共用css內容========================================= -->
    <link href="../lib/css/styles.css" rel="stylesheet" />
    <link href="../lib/font/bootstrap-icons.min.css" rel="stylesheet" />

    <!-- 引入頁籤icon======================================================= -->
    <link rel="icon" type="image/x-icon" href="../lib/img/IX-nobackground.png" />
    <!-- =========================================== -->
    <style>
        .test {
            /* color: #e9e90e; */
            /* font-size: 30px; */
            /* padding: 0; */
            box-sizing: border-box;
            border: solid #0a58ca;
        }

        .test2 {
            color: white;
        }

        .col-8 {
            display: auto;
        }

        input {
            display: flex;
            width: 500px;
        }

        /* h1 {
            display: inline-block;
        } */

        .testbox {
            border: solid #cff900;
        }

        .custom-container {
            max-width: auto;
            /* change this to your desired width */
        }

        /* focus search field dropdown list */
        .dropdown:focus-within .dropdown-menu {
            display: block;
        }

        .vertical {
            vertical-align: top;
        }

        /* =================================================  form 表單================================================ */
        /* ====================================image upload css =====================*/
        /* #preview {
            border: 2px dashed #ccc;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;

        } */

        /* 讓上傳照片的按鈕消失 */
        #photo-dropzone,
        .forDhotoDrop {
            display: none;
        }

        #previewBox.dragover {
            /* border-color: #aaa; */
            border: 1px dashed lightblue;
            box-shadow: 3px 3px 5px lightblue inset, -3px -3px 5px lightblue inset;
        }


        /* teacher's css */
        #previewBox {
            border: 1px solid lightgray;
            /* display: inline-block; */
            /* width: 100%; */
            min-height: 150px;
            position: relative;
            cursor: pointer;
        }


        #previewBox span.text {
            position: absolute;
            display: inline-block;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
            color: lightgray;
        }

        #previewBox img.preview_img {
            width: 100%;
        }

        /* =============================== */
        textarea {
            max-height: 200px;
        }

        /* yellow preview button */
        .ylbtn {
            color: #B6B6B6;
            /* background-color: #ffc107; */
            background-color: #FFF366;

            border: 1px solid #A7A7A7;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
            border-radius: 30px;

        }

        /* form 表單 padding */
        .formpad {
            padding-right: calc(var(--bs-gutter-x) * 1);
            padding-left: calc(var(--bs-gutter-x) * 1);
        }

        /* form -image upload css  */
        #image-preview img {
            max-width: 100%;
            height: auto;
        }

        .event-card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>

<body>

    <!-- 以下導覽列=================================================================================== -->
    <!-- 增加w-100 sticky-top -->
    <nav class="navbar navbar-expand-lg navbar-light w-100 sticky-top navbar-color">
<!--            我回被nav bar .js 套掉-->

    </nav>
    <!-- 導覽列結束=================================================================================== -->

    <!-- 這裡大概是放廣告 -->
    <!-- Header====================================================================================== -->

    <!-- Header====================================================================================== -->

    <!-- main-content -->
    <div class="container ">
        <!-- 請在這裡作業 -->
        <div class="row justify-content-center">
            <div class="col-12">

                <div class="container custom-container  px-4 px-lg-5 mt-5">
                    <!-- ===============form================== -->
                    <!-- <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center"> -->
                    <!-- <div class="row gx-4 gx-lg-5 row-cols-12 justify-content-center"> -->

                    <div class="col -12 row mb-4">
                        <div class=" col-2 "></div>

                        <div class="col-md-8 col-sm-12 formpad " style="background-color: #E9E9E9; padding-top: 10px;">

                            <!-- ================================================form -----submit ================================================== -->
                            <!-- <form action="aaa.html" method="get" class="row g-3 needs-validation" novalidate> -->
                            <!--                            <form action="http://localhost:8081/THA101G1/EventAddServlet" method="post"-->
                            <!--                                enctype="multipart/form-data" class="row g-3 needs-validation" novalidate>-->
                            <!-- <form action="#" method="post" enctype="multipart/form-data" class="row g-3 needs-validation"
                    novalidate> -->

                            <!--                            <form action="http://localhost:8081/THA101G1/EventAddServlet" method="post"-->
                            <!--                                  enctype="multipart/form-data" class="row g-3 needs-validation" novalidate>-->
                            <form class="row g-3 needs-validation pb-4" method="post" novalidate>
                                <!--                            <div class="row g-3 needs-validation" novalidate>-->
                                <br>
                                <h1>創辦活動表單</h1>
                                <hr>
                                <!-- ======================================================image upload ====ccccc============================================================================  -->
                                <!-- image upload ====ccccc===================  -->
                                <div class="row justify-content-center">
                                    <div class="row col-1"></div>
                                    <div class="col-md-10  text-center">
                                        <div class="card mt-5">
                                            <div class="card-body">
                                                <h5 class="card-title">設定活動封面</h5>
                                                <hr>

                                                <div class="form-group">
                                                    <label for="photo-dropzone">點擊下方或將圖片拖放至下方處</label>
                                                    <input type="file" class="form-control-file" name="photo"
                                                        id="photo-dropzone" aria-describedby="fileHelp" accept="image/*"
                                                        required>
                                                    <div class="invalid-feedback">
                                                        請設定活動封面照片
                                                    </div>
                                                    <br>
                                                    <small id="fileHelp" class="form-text text-muted">支援 JPG, JPEG, PNG
                                                        檔案格式</small>
                                                </div>
                                                <div class="form-group">
                                                    <!-- ===zzzz===== -->
                                                    <div id="previewBox">
                                                        <span class="text">點我 或 將圖片丟進來</span>
                                                        <!--
                                                <img id="preview" src="#" alt="圖片預覽"
                                                    style="max-width: 100%; max-height: 200px;"> -->

                                                    </div>
                                                    <!-- ======== -->
                                                </div> <br>
                                                <button type="button" class="btn btn-danger" id="delete-btn">刪除</button>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="row col-1"></div>
                                </div>

                                <!-- ======================================================image upload ====ccccc============================================================================  -->

                                <!-- First row -->
                                <div class="row">
                                    <div class="col-sm-12"></div>
                                    <label for="event_name" class="form-label">聚會名稱</label>
                                    <input type="text" id="event_name" name="event_name" placeholder="請輸入聚會名稱..."
                                           class="form-control" required value="">
                                    <div class="valid-feedback">
                                        Looks good!
                                    </div>
                                    <div class="invalid-feedback">
                                        請填寫聚會名稱
                                    </div>
                                </div>
                                <hr>
                                <br>

                                <!-- Forth row -->
                                <div class="row mb-3">
                                    <div class="col-sm-11">
                                        <label class="form-label">活動地址</label>
                                        <input class="form-control" id="autocomplete-address"
                                               name="autocomplete-address"
                                               placeholder="活動地址..."
                                               required type="text" value="">
                                        <div class="invalid-feedback">
                                            請好好填寫活動地址
                                        </div>
                                    </div>
                                    <!-- 把值塞進隱藏的input-->
                                    <input id="autocomplete-name" type="hidden">
                                    <input id="autocomplete-url" type="hidden">
                                    <input id="autocomplete-formatted-address" type="hidden">

                                </div>

                                <br>

                                <!-- Second row -->
                                <div class="row mb-2">

                                    <div class="col-sm-4">
                                        <label class="form-label" for="categoryId">活動類型</label>
                                        <select class="form-select" id="categoryId" name="categoryId"
                                                aria-label="Default select example" required>
                                            <option selected disabled value="">請選擇..</option>
                                            <option value="1">足球</option>
                                            <option value="2">籃球</option>
                                            <option value="3">網球</option>
                                            <option value="4">排球</option>
                                            <option value="5">橄欖球</option>
                                            <option value="6">棒球</option>
                                            <option value="7">曲棍球</option>
                                            <option value="8">高爾夫球</option>
                                            <option value="9">羽毛球</option>
                                            <option value="10">乒乓球</option>
                                            <option value="11">壁球</option>
                                            <option value="12">手球</option>
                                            <option value="13">保齡球</option>
                                            <option value="14">有氧操</option>
                                            <option value="15">重訓</option>
                                            <option value="16">瑜伽</option>
                                            <option value="17">舞蹈</option>
                                            <option value="18">腹肌</option>
                                            <option value="19">動感單車</option>
                                            <option value="20">跳繩</option>
                                            <option value="21">拳擊</option>
                                            <option value="22">跳舞操</option>
                                            <option value="23">瑜伽拉伸</option>
                                            <option value="24">其他</option>
                                        </select>
                                        <div class="invalid-feedback">
                                            請選擇活動類型
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <label class="form-label" for="city">所在城市</label>
                                        <input class="form-control" disabled id="city" name="city"
                                               placeholder="所在城市.." required type="text">
                                        <!--                                        <select class="form-select" id="city" name="city"-->
                                        <!--                                            aria-label="Default select example" required>-->
                                        <!--                                            <option selected disabled value="">請選擇..</option>-->
                                        <!--                                            <option value="1">One</option>-->
                                        <!--                                            <option value="2">Two</option>-->
                                        <!--                                            <option value="3">Three</option>-->
                                        <!--                                        </select>-->
                                        <div class="invalid-feedback">
                                            請好好填寫活動地址
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <label class="form-label" for="district">所在地區</label>
                                        <input class="form-control" disabled id="district" name="district"
                                               placeholder="所在地區.." required type="text">
                                        <!--                                        <select class="form-select" id="district" name="district"-->
                                        <!--                                            aria-label="Default select example" required>-->
                                        <!--                                            <option selected disabled value="">請選擇..</option>-->
                                        <!--                                            <option value="1">One</option>-->
                                        <!--                                            <option value="2">Two</option>-->
                                        <!--                                            <option value="3">Three</option>-->
                                        <!--                                        </select>-->
                                        <div class="invalid-feedback">
                                            請好好填寫活動地址
                                        </div>
                                    </div>


                                </div>

                                <br>
                                <!-- Third row -->
                                <div class="row">
                                    <div class="col-sm-8">
                                        <label class="form-label">場地名稱</label>
                                        <input class="form-control" id="location" name="location"
                                               placeholder="請輸入聚會場地名稱..."
                                               required type="text" value="">
                                        <div class="invalid-feedback">
                                            請填寫活動舉辦的場地名稱
                                        </div>

                                    </div>
                                    <div class="col-sm-4">
                                        <label class="form-label">預計花費</label>
                                        <input type="number" id="price" name="price" min="0" placeholder="預計花費"
                                               class="form-control" required value="0">
                                        <div class="invalid-feedback">
                                            請輸入預計花費
                                        </div>

                                    </div>

                                </div>

                                <hr>
                                <br>
                                <br>
                                <!--  row Six -->
                                <div class="row mb-2">
                                    <div class="col-sm-5">
                                        <label class="form-label">活動日期</label>
                                        <input type="date" id="eventDate" name="eventDate" placeholder="活動日期..."
                                               class="form-control" onchange="updateMinTime()" required>
                                        <div class="invalid-feedback">
                                            請選擇活動日期
                                        </div>

                                    </div>
                                    <div class="col-sm-5">
                                        <label class="form-label">活動開始時間</label>
                                        <input type="time" id="startTime" name="startTime" placeholder="活動開始時間..."
                                               class="form-control" required step="300" value="">
                                        <div class="invalid-feedback">
                                            請選擇活動開始時間
                                        </div>
                                    </div>

                                </div>

                                <!-- Fith row -->
                                <div class="row mb-3">
                                    <div class="col-sm-7">
                                        <label class="form-label">最後審核時間</label>
                                        <input class="form-control" id="deadline" name="deadline"
                                               placeholder="活動日期..."
                                               min="" required type="datetime-local">
                                        <div class="invalid-feedback">
                                            請好好填寫最後審核時間
                                        </div>
                                    </div>
                                </div>

                                <br>
                                <!-- row  seven ===================================== Javascript ==============================================-->
                                <div class="row mb-4">
                                    <div class="col-sm-5">
                                        <label class="form-label">聚會人數</label>
                                        <input class="form-control" id="maxAttendees" max="100"
                                               min="1"
                                               name="maxAttendees" placeholder="聚會人數" required type="number"
                                               value="">
                                        <div class="invalid-feedback">
                                            請輸入聚會人數
                                        </div>
                                    </div>

                                    <div class="col-sm-5">
                                        <label class="form-label">分錢方式</label>
                                        <select class="form-select" id="paymentMethod" name="paymentMethod"
                                            aria-label="Default select example" required>
                                            <!-- <option selected>打code</option> -->
                                            <option selected disabled value="">請選擇..</option>
                                            <option value="1">我出錢</option>
                                            <option value="2">各付各的</option>
                                            <option value="3">平均分攤</option>
                                            <option value="4">我請客,你出錢</option>
                                        </select>
                                        <div class="invalid-feedback">
                                            請選擇分錢方式
                                        </div>
                                    </div>
                                </div>


                                <br>
                                <!-- row nine -->
                                <div class="row">
                                    <div class="col-sm-12">
                                        <!-- <label for="">聚會描述和備註</label>
                            <textarea id="w3review" name="w3review" rows="4" cols="50">At</textarea> -->
                                        <!-- <input type="" name="" id=""> -->
                                        <!-- </button> -->
                                        <div class="form-group">
                                            <label for="description">聚會描述和備註 (必填*)</label>
                                            <textarea class="form-control" name="description" id="description" rows="3"
                                                required></textarea>
                                            <div class="invalid-feedback">
                                                請好好填寫聚會描述和備註
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <br>
                                <hr>
                                <!-- row eight -->
                                <div class="row">

                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="gridCheck" required>
                                        <label class="form-check-label" for="gridCheck">
                                            我已閱讀並同意免責聲明
                                        </label>
                                    </div>

                                </div>
                                <hr>
                                <br>
                                <!-- row nine -->
                                <div class="row">
                                    <div class="col-sm-12">
                                        <button type="submit" id="btn_submit" class="btn btn-primary">
                                            創辦活動
                                        </button>
                                    </div>
                                </div>
                                <!-- <div class="row justify-content-center">
                        <div class="col-sm-8 ">

                            <div class="d-grid gap-2 ">
                                <button class="btn btn-primary ylbtn" type="button">預覽</button>

                            </div>
                        </div>
                    </div> -->
                                <!-- <br> -->
                                <!-- </form>
                                </form> -->
                                <div class="col-2"></div>
                        </div>

                        <!-- </div> -->
                    </div>
                    <!-- Product actions-->
                    <!-- <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
            
        </div> -->
                </div>


                <!-- <p>team1</p> -->


            </div>

            <!-- ============================================================================================ -->

            <!-- ============================================================================================ -->

        </div>
    </div>



    <!-- 以下footer================================================================================= -->
    <footer class="footer py-5 footer-color bottom-0 ">
        <div class="container">
            <div class="row">
                <div class="col-3">
                    <p class="m-0 text-white h3">客服中心</p>
                    <p class="m-0 text-white">Email: Ixercise@gmail.com</p>
                    <p class="m-0 text-white">Tel: 02-2712-0589</p>
                </div>
                <div class="col-3">
                    <p class="m-0 text-white h3">快速使用</p>
                    <a class="d-block" href="">註冊會員</a>
                    <a class="d-block" href="">舉辦活動</a>
                    <a class="d-block" href="">常見問題</a>
                </div>
                <div class="col-3">
                    <p class="m-0 text-white h3">主要頁面</p>
                    <a class="d-block" href="">首頁</a>
                    <a class="d-block" href="">活動</a>
                    <a class="d-block" href="">論壇</a>
                    <a class="d-block" href="">商城</a>
                </div>
                <div class="col-3"></div>
            </div>
        </div>
    </footer>
    <!-- footer結束================================================================================= -->
    <!-- 引入所需函式庫 -->
    <script src="../lib/js/bootstrap.bundle.min.js"></script>
    <script src="../lib/js/popper.min.js"></script>
    <script src="../lib/vendors/jquery/jquery-3.6.4.min.js"></script>
    <!--    nav bar js-->
    <script src="../lib/js/nav.js"></script>
    <!-- 一定要加這個 defer or async or ascy type="text/javascript"                                                                                                     // 設定語言為繁體中文 -->
    <script defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDg2-TXdbaJlPtWu96Ffe4YTXSb5qXTeEs&libraries=places&callback=initMap&language=zh-TW"
            type="text/javascript"></script>
    <!-- <script src="//code.jquery.com/jquery-1.11.1.min.js"></script> -->
    <!--    text editor-->
    <!--    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->
    <script src="//cdn.ckeditor.com/4.21.0/standard/ckeditor.js"></script>
    <!-- ================================================================= -->

    <script>
        $("#searchbar").on("click", function () {
            $("#searchcard").toggleClass("d-none");
        });
        // text editor
        const editor = CKEDITOR.replace('description');

        //更新最晚 最後審核時間 (max)
        function updateMinTime() {
            const dateInput = document.getElementById('eventDate');
            const timeInput = document.getElementById('deadline');

            // Get the selected date value from the date input
            const selectedDate = dateInput.value;

            // Set the minimum value of the time input based on the selected date
            timeInput.max = selectedDate + 'T00:00';
        }

        //==================================== image upload js ======================zzzz=================================================================
        $(document).ready(function () {

            //set (min) for eventDate & deadline
            let today = new Date();
            let dd = today.getDate();
            let mm = today.getMonth() + 1; // 一月是0，所以要加1
            let yyyy = today.getFullYear();
            let hh = today.getHours();
            let mins = today.getMinutes();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            if (hh < 10) {
                hh = '0' + hh;
            }
            if (mins < 10) {
                mins = '0' + mins;
            }

            let date = yyyy + '-' + mm + '-' + dd;
            let dateTime = yyyy + '-' + mm + '-' + dd + "T" + hh + ":" + mins;

            //let date = today.toISOString().split("T")[0];
            // var dateTime = today.toISOString().slice(0, 16);  //這個方法不好 因為沒辦法自動判斷所在時區
            console.log(dateTime);

            document.getElementById("eventDate").setAttribute("min", date);
            document.getElementById("deadline").setAttribute("min", dateTime);

            // ============================  setting input for time and datetime only allow 5 minutes intervals ================ start ======

            // get input elements
            const start = document.getElementById('startTime');
            const end = document.getElementById('startTime');
            const deadline = document.getElementById('deadline');


            deadline.addEventListener('change', () => {
                // Splitting the date and time
                const [datePart, timePart] = deadline.value.split("T");
                const newTime = rounder(timePart);
                deadline.value = `${datePart}T${newTime}`;
            });

            start.addEventListener('change', () => {
                const newTimes = rounder(start.value);
                end.value = `${newTimes}`;
            });

            function rounder(timeInput) {
                // get hours and minutes as integer values
                //  21:50 --> ["21", "50"]//
                let hours = parseInt(timeInput.split(':')[0]);
                let minutes = parseInt(timeInput.split(':')[1]);

                // const result = Number((num / 5).toFixed(0) * 5);
                // const num = 52.4281; --> 50
                // const num = 52.5281; --> 55 (52.5 / 5 => 10.5 , toFixed(0) <小數點第1位 (0)> => 10 * 5 => 50)
                // const num = 53; --> 55

                // minutes = Math.round(minutes / 10) * 10;                 // 10 minutes intervals
                minutes = Number((minutes / 5).toFixed(0) * 5);     //讓用戶只能設定時間以每五分鐘的間隔 set the input time to only allow every 5 minutes intervals

                // if an hour is exceeded, add it to hours instead
                // and account for a day passing by

                if (minutes >= 60) {
                    hours = (hours + 1) % 24;
                    minutes -= 60;
                }
                // reformat values as strings with a fix length of 2
                hours = (hours < 10 ? `0${hours}` : `${hours}`);
                console.log(hours);
                minutes = (minutes < 10 ? `0${minutes}` : `${minutes}`);
                // assign new value to the end input

                return `${hours}:${minutes}:00`;
            }

            // ============================  setting input for time and datetime only allow 5 minutes intervals ================ end ======

            //==================================== image preview ================================================================= start ========

            // #previewBox can only be click when no images are in the input files
            $("#previewBox").on("click", function () {

                console.log($(this).attr("restrictChange"));
                if ($(this).attr("restrictChange") == undefined) {
                    $("#photo-dropzone").click();
                } else {
                    return;
                }
            });

            // Preview selected image
            $("#photo-dropzone").change(function () {
                readURL(this);
            });

            // Delete selected image
            $("#delete-btn").click(function () {
                $("#previewBox").html('<span class="text">點我 或 將圖片丟進來</span>');
                $("#previewBox").removeAttr("restrictChange");
            });

            // Preview image function =================zzzz=================
            function readURL(input) {
                $("#previewBox").attr("restrictChange", true);
                // if (this.files.length > 0) {  多張
                // ===============================================================
                // if (input.files && input.files[0]) {  單張
                //     preview_img(input.files);
                // }
                // ========================================================================
                if (input.files && input.files[0]) {
                    if (input.files[0].type.match('image.*')) {

                        $("#previewBox").html('<img src="' + URL.createObjectURL(input.files[0]) + '" class="preview_img">');
                        // var reader = new FileReader();
                        // reader.onload = function () {
                        //     $("#previewBox").html('<img src="' + reader.result + '" class="preview_img">');
                        // };
                        // reader.readAsDataURL(input.files[0]);

                    }
                }
            }

            // ==================== allow preview events==============

            // Allow preview area to be a drop zone
            var previewArea = document.getElementById('previewBox');
            previewArea.addEventListener('dragenter', function (e) {
                e.stopPropagation();
                e.preventDefault();
                previewArea.classList.add('dragover');
            });

            previewArea.addEventListener('dragleave', function (e) {
                e.stopPropagation();
                e.preventDefault();
                previewArea.classList.remove('dragover');
            });

            previewArea.addEventListener('dragover', function (e) {
                e.stopPropagation();
                e.preventDefault();
            });
            // ==add=

            //===================drop photo preview =================
            previewArea.addEventListener('drop', function (e) {
                e.stopPropagation();
                e.preventDefault();
                previewArea.classList.remove('dragover');
                $(this).attr("restrictChange", true);
                // ======================================================
                var files = e.dataTransfer.files;
                var file = files[0];
                if (file.type.match('image.*')) {
                    var reader = new FileReader();

                    reader.onload = function () {
                        // $('#preview').attr('src', reader.result);
                        $("#previewBox").html('<img src="' + reader.result + '" class="preview_img">');
                        // $('#photo-dropzone').val("aaaa");
                        // $('#photo-dropzone').val(file.name);
                        $('#photo-dropzone').prop('files', files);;
                    };

                    reader.readAsDataURL(file);
                }
            });


            // ====================drop image - preview =====

            // ========================(file) one single picture
            var preview_img = function (file) {
                if (file.type.match('image.*')) {
                    var reader = new FileReader();

                    reader.onload = function () {
                        // $('#preview').attr('src', reader.result);
                        $("#previewBox").html('<img src="' + reader.result + '" class="preview_img">');
                        // $('#photo-dropzone').val(file.name);
                        $('#photo-dropzone').prop('files', files);
                        ;
                    };

                    reader.readAsDataURL(file);
                }
            };
            //==================================== image upload js -gpt =======================================================================================
            //==================================== text-editor =======================================================================================

            // $('#alertContent').click(function () {
            //     // CKEDITOR.instances.editorDemo.updateElement();
            //     // console.log($('textarea[name=editorDemo]').val());
            //     // console.log(CKEDITOR.instances.editorDemo.getData());
            //     CKEDITOR.instances.editorDemo.updateElement();
            //     // 因為先把編輯器更新回textarea了，這裡就可以抓到目前最新的內容
            //     console.log($('textarea[name=description]').val());
            // });

            //==================================== form-input validate &&  session storage =======================================================================================
            // Example starter JavaScript for disabling form submissions if there are invalid fields
            (function () {
                'use strict'

                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.querySelectorAll('.needs-validation')

                // Loop over them and prevent submission
                Array.prototype.slice.call(forms)
                    .forEach(function (form) {
                        form.addEventListener('submit', function (e) {

                            //=========== 檢查輸入的地點是否在google map 上有效=====(simulating : input focus, trim, enter, blur(unfocused) )=== start =============
                            let autoAddress = document.querySelector("#autocomplete-address");
                            $("#autocomplete-address").focus();
                            $("#autocomplete-address").val($("#autocomplete-address").val().trim());

                            // 模擬enter 鍵
                            const ke = new KeyboardEvent('keydown', {
                                bubbles: true, cancelable: true, keyCode: 13
                            });
                            autoAddress.dispatchEvent(ke);
                            $("#autocomplete-address").blur();
                            //=========== 檢查輸入的地點是否在google map 上有效======= end ==============

                            if (!form.checkValidity()) {
                                e.preventDefault()
                                e.stopPropagation()
                                console.log("!form.checkValidity()");
                            } else {
                                console.log("hiii");
                                e.preventDefault();

                                // ==========  text-editor ================= start ==========

                                CKEDITOR.instances.description.updateElement();
                                // 因為先把編輯器更新回textarea了，這裡就可以抓到目前最新的內容
                                // console.log($('textarea[name=description]').val());

                                // ==========  text-editor ================= end ==========

                                var event = {};

                                // event.photo = $("#photo-dropzone").val();
                                event.eventName = $("#event_name").val();
                                // event.categoryId = $("#categoryId").val();
                                event.categoryId = $("#categoryId option:selected").text();
                                event.city = $("#city").val();
                                event.district = $("#district").val();
                                event.location = $("#location").val();

                                //把隱藏input 的值裝進 event
                                event.address4input = $("#autocomplete-address").val();
                                event.address = $("#autocomplete-formatted-address").val();
                                event.addressUrl = $("#autocomplete-url").val();
                                event.addressNickname = $("#autocomplete-name").val();

                                event.price = $("#price").val();
                                event.eventDate = $("#eventDate").val();
                                // event.startTime = $("#startTime").val() + ':00';
                                event.startTime = $("#startTime").val();
                                event.maxAttendees = $("#maxAttendees").val();
                                event.paymentMethod = $("#paymentMethod").val();
                                event.description = $('textarea[name=description]').val();
                                event.deadline = $("#deadline").val();

                                // =========================== >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                                event.creatorId = localStorage.getItem("accountId");
                                // =========================== >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>


                                // console.log(event);
                                //
                                // var img_base64_el = document.querySelector(".preview_img");
                                // if (img_base64_el) {
                                //     event.img_base64 = img_base64_el.getAttribute("src");
                                // }
                                var img_base64_el = document.querySelector(".preview_img");
                                console.log(img_base64_el);
                                let img_base64;
                                if (img_base64_el) {
                                    img_base64 = img_base64_el.getAttribute("src");
                                }

                                console.log("eventPhoto: " + img_base64);

                                const photouploas = new FileReader();


                                // 把資料存到session 裡面-先不存到資料庫- 給預覽頁面座使用
                                let formData = JSON.stringify(event);
                                sessionStorage.setItem("Event", formData);
                                sessionStorage.setItem("eventphoto", img_base64);
                                console.log(formData);
                                //direct to the preview page
                                // window.location.href = "Event_preview_page.html";

                                $.ajax({
                                    // url: 'http://localhost:8081/THA101G1/event/photo', // Replace with the actual servlet URL
                                    url: "../event/create",
                                    type: 'POST',
                                    data: formData,
                                    dataType: 'json',
                                    contentType: "application/json; charset=utf-8",
                                    success: function (response) {
                                        // Handle success response here
                                        console.log(response);
                                        console.log(typeof response); // Check the type of the response
                                        console.log(JSON.parse(response)); // Attempt to parse the response as JSON
                                        upLoadPhoto(response);
                                    },
                                    error: function (xhr, status, error) {
                                        // Handle error here
                                        console.log(xhr.responseText);
                                    }
                                });
                            };


                            form.classList.add('was-validated')

                        }, false)
                    })

                function upLoadPhoto(eventId) {
                    var photoFile = $('#photo-dropzone')[0].files[0];
                    let photo1 = new FormData();
                    photo1.append("photo", photoFile);
                    console.log($("#photo-dropzone").val());

                    console.log(photoFile);
                    console.log(photo1);

                    $.ajax({
                        // url: 'http://localhost:8081/THA101G1/event/photo', // Replace with the actual servlet URL
                        url: "../event/create/image/" + eventId,
                        type: 'PUT',
                        data: photo1,
                        // dataType: 'json', // 或者使用 'text'
                        // contentType: "application/json; charset=utf-8",
                        enctype: 'multipart/form-data',
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            // Handle success response here
                            console.log(response);
                            // /create/images/{eventId}
                            // upLoadPhoto(response);
                            if (response == true) {
                                alert("活動創辦成功");
                                location = '/ixercise/Woo/Event_homePage.html';
                            } else {
                                alert("活動創辦失敗");
                            }
                        },
                        error: function (xhr, status, error) {
                            // Handle error here
                            console.log(xhr.responseText);
                            console.log(xhr);
                            console.log(error);
                        }
                    });

                }

            })()
            // =========================== 資料送出 ========================= //
            // =========================== session storge ========================= //

            // =========================== >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
            // sessionStorage.setItem("accountId", "1");
            // =========================== >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

            const data = sessionStorage.getItem('Event');
            console.log("data: " + data);

            if (data != null) {
                const sessionFormData = JSON.parse(data);   //sessionFormData
                // ============ photo -> are not processing due to troublesome
                // $("#previewBox").html('<img src="' + sessionFormData.img_base64 + '" class="preview_img">');     // imgElement.src = 'data:image/png;base64,' + base64Data;
                // $("#photo-dropzone").val(sessionFormData.photo_dropzone);
                // $('#photo-dropzone').prop('files', sessionFormData.photo_dropzone);;

                $("#event_name").val(sessionFormData.eventName);
                $("#categoryId").val(sessionFormData.categoryId);
                $("#city").val(sessionFormData.city);
                $("#district").val(sessionFormData.district);
                $("#location").val(sessionFormData.location);


                //把session 的值裝進 event 隱藏input
                $("#autocomplete-address").val(sessionFormData.address4input);
                $("#autocomplete-formatted-address").val(sessionFormData.address);
                $("#autocomplete-url").val(sessionFormData.addressUrl);
                $("#autocomplete-name").val(sessionFormData.addressNickname);

                $("#price").val(sessionFormData.price);
                $("#eventDate").val(sessionFormData.eventDate);
                $("#startTime").val(sessionFormData.startTime);
                $("#deadline").val(sessionFormData.deadline);
                $("#maxAttendees").val(sessionFormData.maxAttendees);
                $("#paymentMethod").val(sessionFormData.paymentMethod);
                $("#description").val(sessionFormData.description);

            }


        }); //Load ====
        //==================================== google map api =======================================================================================
        // JavaScript 程式碼在這裡
        // 載入 Google 地圖 API 腳本
        function initMap() {
            // 設定地點自動完成欄位
            let input = document.getElementById('autocomplete-address');

            // 建立地點自動完成物件
            const autocomplete = new google.maps.places.Autocomplete(input);

            // 設定國家
            autocomplete.setComponentRestrictions({'country': ['tw']});

            // 監聽當地點選擇事件
            autocomplete.addListener('place_changed', () => {
                const place = autocomplete.getPlace();
                console.log("place--");
                console.log(place);
                console.log(place.url);         //https://maps.google.com/?cid=7060274125268772127
                console.log(place.formatted_address); //詳細地址  e.g:106台灣台北市大安區新生南路二段1號
                console.log(place.name);        //e.g.: 大安森林公園
                console.log(place.website);

                // 檢查是否有選擇地點
                if (!place.geometry || !place.geometry.location) {
                    window.alert('在Google maps 上查不到: \'' + place.name + '\' , 請重新輸入..');
                    $("#autocomplete-address").val("");
                    return;
                }
                //把值塞進隱藏的input
                $("#autocomplete-formatted-address").val(place.formatted_address);
                $("#autocomplete-url").val(place.url);
                $("#autocomplete-name").val(place.name);

                //如果用戶沒輸入 地點 -> 幫他填
                if ($("#location").val() == "") {
                    $("#location").val(place.name);
                }


                let addressHtmlCode = place.adr_address;
                console.log(addressHtmlCode);
                //  the HTML code returned from "adr_address" is stored in a variable 'addressHtmlCode'
                const htmlparser = new DOMParser();
                const doc = htmlparser.parseFromString(addressHtmlCode, "text/html");

                // Select the element with the class 'region',  abd Get the text content of the selected element
                const regionText = doc.querySelector(".region").textContent;
                const localityText = doc.querySelector(".locality").textContent;

                $("#city").val(regionText);
                $("#district").val(localityText);
                console.log($("#district").val());

            });
        }


        // function updateEventPhoto(eventId, photoData) {
        //     $.ajax({
        //         url: '/events/' + eventId + '/photo',
        //         type: 'PUT',
        //         data: photoData,
        //         processData: false,
        //         contentType: 'application/octet-stream',
        //         success: function() {
        //             // Handle the success response
        //             console.log('Event photo updated successfully');
        //         },
        //         error: function(xhr, status, error) {
        //             // Handle the error response
        //             console.error('Error updating event photo:', error);
        //         }
        //     });
        // }
        //
        // // Usage
        // var eventId = 123;  // Replace with the actual event ID
        // var photoData = // Retrieve the updated photo byte array
        //
        //     updateEventPhoto(eventId, photoData);


    </script>
</body>

</html>
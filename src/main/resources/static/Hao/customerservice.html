<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ixercise</title>
    <!-- 引入bootstarp跟共用css內容========================================= -->
    <link href="../lib/css/styles.css" rel="stylesheet" />
    <link href="../lib/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- 引入頁籤icon======================================================= -->
    <link rel="icon" type="image/x-icon" href="../lib/img/IX-nobackground.png" />
    <!-- =========================================== -->
    <style>
        .square-image {
            /* position: absolute; */
            top: 0;
            left: 0;
            width: 74px;
            height: 74px;
            object-fit: cover;
        }

        .notifyp {
            height: 60px;
            /* width: 350px; */
            /* padding: 10px;
            border: 2px solid #4d4d4d;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            box-sizing: border-box; */
        }



        

        body{margin-top:20px;}


.chat-messages {
    display: flex;
    flex-direction: column;
  
 
}


                    

.chat-message-left,
.chat-message-right {
    display: flex;
    flex-shrink: 0
}

.chat-message-left {
    margin-right: auto
}

.chat-message-right {
    flex-direction: row-reverse;
    margin-left: auto
    
}

.py-3 {
    padding-top: 2rem!important;
    padding-bottom: 2rem!important;
}
.px-4 {
    padding-right: 2rem!important;
    padding-left: 2rem!important;
}
.flex-grow-0 {
    flex-grow: 0!important;
}

.border-top {
    border-top: 1px solid #dee2e6!important;
}
.buttoncolor{
  background-color: rgba(111, 111, 111, 0.073) !important;
}

.messagecolor{
    background-color: rgba(62, 61, 61, 0.192) !important;
}

.talkstartes{
    min-height: 450px;
}

    </style>
</head>

<body  onload="connect();" onunload="disconnect();">
    <!-- 我是V6，修改如下 -->
    <!-- 1.修正會員彈出選單頭像會跑版的問題 -->
    <!-- 2.修正通知圖片會有跑板問題 -->
    <!-- 以下導覽列=================================================================================== -->
    <!-- 增加w-100 sticky-top -->
    <nav class="navbar navbar-expand-lg navbar-light w-100 sticky-top navbar-color">
        <div class=" container-fluid px-4 px-lg-0 me-4 ">

            <!-- 商標===================================================================== -->
            <a class="navbar-brand m-0 px-4" href="#!">
                <img src="../lib/img/IX-nobackground.png" alt="" width="91" height="60">
            </a>
            <!-- Bootstrap 5 的 Navbar Toggler 按鈕，用於在手機和平板等較小螢幕上，點擊按鈕時切換導覽列的展開和收縮狀態。 -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

            <!-- 商標的右邊整條============================================================ -->
            <div class="collapse navbar-collapse " id="navbarSupportedContent">

                <ul class="navbar-nav mb-2 mb-lg-0 w-100">
                    <!-- 搜尋欄=============================================================== -->
                    <!-- <li class="nav-item my-auto">
                        <form class="d-flex">
                            <input class="form-control" type="search" placeholder="找活動..." aria-label="Search">
                            <button class="btn border border-2 border-dark" type="submit">Search</button>
                        </form>
                    </li> -->

                    <li class="nav-item my-auto">
                        <form class="d-flex row">
                            <div class="row" style="width: 400px; max-width: 400px;">
                                <div class="col-8 pe-0">
                                    <input class="form-control" id="searchbar" type="search" placeholder="搜尋..."
                                        aria-label="Search" role="button">
                                    </input>
                                </div>
                                <div class="col-4 ps-0">
                                    <button class="btn border border-1 border-dark" type="submit">Search</button>
                                </div>
                            </div>

                            <!-- </form> -->
                            <!-- ================================================================== -->
                            <!-- <div class="collapse" id="collapseExample"> -->
                            <div id="searchcard" class="d-none">
                                <div class="searchbarthing w-50 position-fixed">
                                    <!-- <form action="" class="row mb-0"> -->
                                    <div class="row mb-0">
                                        <div class="col-3">
                                            <!-- <label for=""></label> -->
                                            <select class="form-select form-select-sm col-3 mb-3"
                                                aria-label="Default select example">
                                                <option selected>頁面 </option>
                                                <option value="1">商城</option>
                                                <option value="2">論壇</option>
                                                <option value="3">活動</option>
                                            </select>
                                        </div>
                                        <div class="col-3">
                                            <select class="form-select form-select-sm"
                                                aria-label="Default select example">
                                                <option selected>運動類型 </option>
                                                <option value="1">One</option>
                                                <option value="2">Two</option>
                                                <option value="3">Three</option>
                                            </select>
                                        </div>
                                        <div class="col-3">
                                            <select class="form-select form-select-sm"
                                                aria-label="Default select example">
                                                <option selected>各自設定 </option>
                                                <option value="1">One</option>
                                                <option value="2">Two</option>
                                                <option value="3">Three</option>
                                            </select>
                                        </div>
                                        <div class="col-3">
                                            <select class="form-select form-select-sm"
                                                aria-label="Default select example">
                                                <option selected>各自設定 </option>
                                                <option value="1">One</option>
                                                <option value="2">Two</option>
                                                <option value="3">Three</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <!-- <div class="col-9"></div> -->
                                            <div class="col-12 ">
                                                <!-- <button class="btn btn-primary" type="submit"> 查詢
                                            </button> -->
                                                <button class="btn btn-primary" type="button"
                                                    id="btn-close-search">關閉</button>
                                                <button class="btn btn-primary" type="reset"
                                                    id="btn-reset-search">重置</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </li>

                    <!-- <div class="collapse  d-block" id="collapseExample">
                    </div> -->


                    <!-- 辦活動============================================================= -->
                    <li class="nav-item fs-5 ms-auto my-auto">
                        <a class="nav-link active h-100 " aria-current="page" href="#!">辦活動
                        </a>
                    </li>
                    <!-- 其他主頁  ========================================================== -->
                    <li class="nav-item fs-5 dropdown my-auto">
                        <a class="nav-link dropdown-toggle navalable" id="navbarDropdown" href="#" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">其他主頁
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#!">首頁</a></li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li><a class="dropdown-item" href="#!">商城</a></li>
                            <li><a class="dropdown-item" href="#!">論壇</a></li>
                            <li><a class="dropdown-item" href="#!">活動</a></li>
                            <li><a class="dropdown-item" href="#!">課程</a></li>
                        </ul>
                    </li>
                    <!-- 鈴鐺============================================================= -->
                    <!-- 還有一顆填滿的bi-bell-fill -->
                    <!-- 操控.n-dot來控制有無紅點 -->
                    <li class="nav-item dropdown my-auto">
                        <div class="n-dot"></div>
                        <svg width="36" height="36" fill="currentColor"
                            class="bi bi-bell dropdown-toggle dropdown-toggle" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" viewBox="0 0 16 16">
                            <path
                                d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zM8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z" />
                        </svg>
                        <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="navbarDropdown">
                            <!-- 一條通知====================================================== -->
                            <!-- 完成版 600px -->
                            <div class="list-group notifyunread">
                                <a href="#" class="list-group-item list-group-item-action" aria-current="true"
                                    style="height: 93px; width:600px;">
                                    <div class="row h-100">
                                        <div class="col-2 h-100">
                                            <img src="https://picsum.photos/150/200/?random=10" width="72px"
                                                height="72px" alt="" style="object-fit:cover">
                                        </div>
                                        <div class="col-10">
                                            <div class="d-flex w-100 justify-content-between">
                                                <p class="mb-1" style=" overflow: hidden;">
                                                    一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十
                                                </p>
                                                <small style="white-space: nowrap;">3 days ago</small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="list-group notifyunread">
                                <a href="#" class="list-group-item list-group-item-action" aria-current="true"
                                    style="height: 93px; width:600px;">
                                    <div class="row h-100">
                                        <div class="col-2 h-100">
                                            <img src="https://picsum.photos/150/200/?random=10" width="72px"
                                                height="72px" alt="" style="object-fit:cover">
                                        </div>
                                        <div class="col-10">
                                            <div class="d-flex w-100 justify-content-between">
                                                <p class="mb-1" style=" overflow: hidden;">
                                                    一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十
                                                </p>
                                                <small style="white-space: nowrap;">3 days ago</small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </ul>
                    </li>

                    <!-- 會員頭像========================================================= -->
                    <li class="nav-item dropdown mx-2 my-auto">
                        <img src="https://picsum.photos/300/200/?random=10"
                            class="nav-link dropdown-toggle overflow-hidden rounded-circle p-0" id="navbarDropdown"
                            href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" width="36"
                            height="36">

                        <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="navbarDropdown">

                            <li>
                                <img class="dropdown-item overflow-hidden p-2 rounded-circle"
                                    src="https://picsum.photos/200/200/?random=10">
                            </li>
                            <li>
                                <span class="dropdown-item-text justify-content-center d-flex fs-5">名字</span>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#!">查看個人資料</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#!">聊天列表</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#!">活動管理</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#!">課程管理</a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <!-- 購物車的按鈕============================================================= -->
                <form class="d-flex">
                    <button class="btn btn-outline-dark d-flex text-nowrap" type="submit">
                        <!-- 這個車車改class為bi-cart的話 就會變成空車 -->
                        <i class="bi-cart-fill me-1"></i>
                        購物車
                        <span class="badge bg-dark text-white ms-1 rounded-pill my-auto">0</span>
                    </button>
                </form>
            </div>
        </div>
    </nav>
    <!-- 導覽列結束=================================================================================== -->

    <!-- 這裡大概是放廣告 -->
    <!-- Header====================================================================================== -->
    <!-- <header>
        <div class="container-fluid p-0">
            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0"
                        class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
                        aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
                        aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active w-100 object-fit-cover">
                        <img src="https://picsum.photos/1920/300/?random=10" class="d-block" alt="...">
                    </div>
                    <div class="carousel-item w-100 object-fit-cover">
                        <img src="https://picsum.photos/1920/300/?random=11" class="d-block" alt="...">
                    </div>
                    <div class="carousel-item w-100 object-fit-cover">
                        <img src="https://picsum.photos/1920/300/?random=12" class="d-block" alt="...">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </header> -->
    <!-- Header====================================================================================== -->

    <!-- main-content -->


        
                    <main class="content">
                        <div class="container p-0 main-content py-5">
                    
                            <h1 class="h1 mb-3">客服中心</h1>
                    
                            <div class="card ">
                                <div class="row g-0">
                                  
                                    <div class="col-12 ">

                                        <!--以下是按鈕-->
                                         <div class="py-2 px-4 border-bottom d-none d-lg-block buttoncolor">
                                            <div class="d-flex align-items-center py-1 ">
                                                <!-- <div class="position-relative">
                                                    <img src="https://bootdey.com/img/Content/avatar/avatar3.png" class="rounded-circle mr-1" alt="Sharon Lessman" width="40" height="40">
                                                </div>
                                                <div class="flex-grow-1 pl-3">
                                                    <strong>Sharon Lessman</strong>
                                                    <div class="text-muted small"><em>Typing...</em></div>
                                                </div> -->
                                                <div>
                                                    <button class="btn btn-primary btn-lg mr-1 px-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone feather-lg"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg></button>
                                                    <button class="btn btn-info btn-lg mr-1 px-3 d-none d-md-inline-block"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-video feather-lg"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg></button>
                                                    <button class="btn btn-light border btn-lg px-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal feather-lg"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></button>
                                                </div>
                                            </div>
                                        </div> 

                    
                                        <div class="position-relative">
                                            <div class="chat-messag talkstartes p-4">
                                                

                                               
                                                <!-- <div class="chat-message-left pb-4">
                                                    <div>
                                                        <img src="https://bootdey.com/img/Content/avatar/avatar3.png" class="rounded-circle mr-1" alt="Sharon Lessman" width="40" height="40">
                                                        <div class="text-muted small text-nowrap mt-2">2:36 am</div>
                                                    </div>
                                                    <div class="flex-shrink-1 messagecolor   rounded py-2 px-3 ml-3">
                                                        <div class="font-weight-bold mb-1">Sharon Lessman</div>
                                                        Sed pulvinar, massa vitae interdum pulvinar, risus lectus porttitor magna, vitae commodo lectus mauris et velit.
                                                        Proin ultricies placerat imperdiet. Morbi varius quam ac venenatis tempus.
                                                    </div>
                                                </div>
                    
                    
                                                <div class="chat-message-right mb-4">
                                                    <div>
                                                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png" class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
                                                        <div class="text-muted small text-nowrap mt-2">2:38 am</div>
                                                    </div>
                                                    <div class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
                                                        <div class="font-weight-bold mb-1">You</div>
                                                        Lorem ipsum dolor sit amet, vis erat denique in, dicunt prodesset te vix.
                                                    </div>
                                                </div>
                    
                                                <div class="chat-message-right mb-4">
                                                    <div>
                                                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png" class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
                                                        <div class="text-muted small text-nowrap mt-2">2:40 am</div>
                                                    </div>
                                                    <div class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
                                                        <div class="font-weight-bold mb-1">You</div>
                                                        Cum ea graeci tractatos.
                                                    </div>
                         
                    
                                                </div> -->
                                        </div>
                                        
                                        <form  id="messageid" class="messageid" method="POST">

                                        <div class="py-3 px-4 border-top  buttoncolor">
                                            <div class="input-group">
                                                <input type="text" class="py-3 form-control inputvalue" placeholder="請輸入文字 ">
                                                <button type="submit" class="btn btn-primary submit btn-control">Send</button>
                                            </div>
                                        </div>
                                    </form>
                                    </div>

                                    
                                </div>
                            </div>
                        </div>
                    </main>   
                    
                    
     



    <!-- 以下footer================================================================================= -->
    <footer class="footer py-5 footer-color">
        <div class="container">
            <div class="row">
                <div class="col-3">
                    <p class="m-0 text-white h3">客服中心</p>
                    <p class="m-0 text-white">Email: Ixercise@gmail.com</p>
                    <p class="m-0 text-white">Tel: 02-2712-0589</p>
                </div>
                <div class="col-3">
                    <p class="m-0 text-white h3">快速使用</p>
                    <a class="d-block" href="">註冊會員</a>
                    <a class="d-block" href="">舉辦活動</a>
                    <a class="d-block" href="">常見問題</a>
                </div>
                <div class="col-3">
                    <p class="m-0 text-white h3">主要頁面</p>
                    <a class="d-block" href="">首頁</a>
                    <a class="d-block" href="">活動</a>
                    <a class="d-block" href="">論壇</a>
                    <a class="d-block" href="">商城</a>
                </div>
                <div class="col-3"></div>
            </div>
        </div>
    </footer>
    <!-- footer結束================================================================================= -->
    <!-- 引入所需函式庫 -->
    <script src="../lib/js/bootstrap.bundle.min.js"></script>
    <script src="../lib/js/popper.min.js"></script>
    <script src="../lib/vendors/jquery/jquery-3.6.4.min.js"></script>
    <!-- ================================================================= -->

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        $("#searchbar").focus("click", function () {
            $("#searchcard").removeClass("d-none");
        });
        $("#btn-close-search").on("click", function () {
            $("#searchcard").addClass("d-none");
        })
    </script>


<script
  src="https://code.jquery.com/jquery-3.7.0.js"
  integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM="
  crossorigin="anonymous">
</script>



    <script>


var  localStorageId=localStorage.getItem('accountId');
var  localStorageNickname=localStorage.getItem('accountNickname');
var  localStoragePhoto=localStorage.getItem('accountPhoto');

// 現在時間
var currentDate = new Date();

// 获取当前时间的小时、分钟和秒

var month = currentDate.getMonth() + 1; // 注意：月份从0开始，所以要加1
var day = currentDate.getDate();
var hours = currentDate.getHours();
var minutes = currentDate.getMinutes();


// 格式化月份和日期，确保它们始终显示为两位数
// 格式化小时、分钟和秒，确保它们始终显示为两位数
month = (month < 10 ? "0" : "") + month;
day = (day < 10 ? "0" : "") + day;

hours = (hours < 10 ? "0" : "") + hours;
minutes = (minutes < 10 ? "0" : "") + minutes;

// 构建时间字符串
var currentTime =month + "/" + day+"<br>"+ hours + ":" + minutes ;
var timestamp = new Date(new Date().getTime() + (480* 60000)).toISOString();
console.log(currentTime);
console.log(timestamp);




$(function(){
  
    var chineseConfirmed = false; // 是否已經確認中文內容

$(document).on('keydown', 'input.inputvalue', function(e) {
  if (e.which == 13) {
    if (!chineseConfirmed) {
      // 中文輸入法尚未確認，阻止按下 Enter 鍵的預設行為
      e.preventDefault();
    }
  }
});

$(document).on('compositionend', 'input.inputvalue', function() {
  // 中文輸入確認完成，設置中文已確認為 true
  chineseConfirmed = true;
});
  
  $(".btn-control").on("click", function(){
   
    var input_text = ($("input.inputvalue").val()).trim();
   

    if(input_text ==""){
      alert("請輸入資料");
    }else{
         timestamp = new Date(new Date().getTime() + (480* 60000)).toISOString();
        
      
      let html = `
       
      <div class="chat-message-right mb-4">
      <div><img src="data:image/jpeg;base64,`+localStoragePhoto+`" class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
      <div class="text-muted small text-nowrap mt-2">${currentTime}</div></div>
      <div class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
      <div class="font-weight-bold mb-1">`+localStorageNickname+`</div>${input_text }</div></div>
      `;
      $(".talkstartes").append(html);
      
      sendMessage(input_text);



 var form = document.getElementById('messageid');

form.addEventListener('submit', function(event) {
  event.preventDefault(); // 阻止表单默认提交行为
  // 在这里处理表单数据和发送请求
  // ...
});






var inputField = form.querySelector('.inputvalue');
var inputValue = ($(".inputvalue").val().trim());
var  currentDate = new Date();
var formData = {
  message: inputValue,
  messageTime:currentDate.getHours()+currentDate.getMinutes()
};


var mydata = JSON.stringify(formData);
console.log(mydata);

// 进一步处理 JSON 数据，例如通过 AJAX 发送到服务器等

// $.ajax({
// url:  "http://localhost:8080/ixercise/set",
// type: 'POST',
// contentType: 'application/json',
// data: mydata,
// success: function(response) {
// // 請求成功，進行相應的處理
// console.log(response);

// },
// error: function(xhr, status, error) {
// // 請求失敗，處理錯誤
// console.error(error);
// }
// });


      
    
      $("input.inputvalue").val("");



      
    }
  });
  
});

function sendMessage(input_text) {
              
    console.log("我輩執行到");
              timestamp = new Date(new Date().getTime() + (480* 60000)).toISOString();
              var jsonObj = {
           "type" : "chat",
           "sender" : localStorageId,
           "receiver" : 5,
           "message" : input_text,
           "messageTime":timestamp
           };
           webSocket.send(JSON.stringify(jsonObj));
        }

//下面是存redis資料庫

</script>

  
<script>
// 获取表单元素
var form = document.getElementById('messageid');

form.addEventListener('submit', function(event) {
  event.preventDefault(); // 阻止表单默认提交行为
  // 在这里处理表单数据和发送请求
  // ...
});
var inputField = form.querySelector('.inputvalue');
var inputValue = ($("input.inputvalue").val()).trim();
var  currentDate = new Date();
var formData = {
  message: inputValue,
  messageTime:currentDate.getHours()+currentDate.getMinutes()
};


var mydata = JSON.stringify(formData);
console.log(mydata);

// 进一步处理 JSON 数据，例如通过 AJAX 发送到服务器等

// $.ajax({
// url:  "http://localhost:8080/ixercise/set",
// type: 'POST',
// contentType: 'application/json',
// data: mydata,
// success: function(response) {
// // 請求成功，進行相應的處理
// console.log(response);
// showConfirmationPopup();
// },
// error: function(xhr, status, error) {
// // 請求失敗，處理錯誤
// console.error(error);
// }
// });






</script>


<script>

	var webSocket;
    var currentDate = new Date();
    var localStorageId = localStorage.getItem('accountId');
    var  localStorageNickname=localStorage.getItem('accountNickname');
    var  localStoragePhoto=localStorage.getItem('accountPhoto');

    var timezoneOffset = 480; // 台灣時區為 UTC+8，即480分鐘


    currentDate.setMinutes(currentDate.getMinutes() + timezoneOffset);

    var formattedDate = currentDate.toISOString().slice(0, 16);

    timestamp = new Date(new Date().getTime() + (480* 60000)).toISOString();
    console.log(timestamp)
	function connect() {
		// create a websocket
		webSocket = new WebSocket("ws://localhost:8080/ixercise/FriendWS/" +localStorageId );

		webSocket.onopen = function(e) {
			console.log("Connect Success!");
            console.log(e);
             
        var jsonObj = {
					"type" : "history",
					"sender" :localStorageId ,
					"receiver" : 5,
					"message" : "",
                    "messageTime":timestamp
				};
			webSocket.send(JSON.stringify(jsonObj));
		
		
		};

		webSocket.onmessage = function(e) {
			var jsonObj = JSON.parse(event.data);
            console.log(e);
			if ("new" === jsonObj.type) {
                var html = `<h2>常見問題</h2>
<ul class="faq-list">
  <li>
    <a data-toggle="collapse" href="#collapseQuestion1">問題1：如何註冊帳號？</a>
    <div id="collapseQuestion1" class="collapse">
      <p>在註冊頁面上點擊「註冊」按鈕，填寫所需的資訊，並按照指示完成註冊程序。</p>
    </div>
  </li>
  <li>    
    <a data-toggle="collapse" href="#collapseQuestion2">問題2：我忘記了密碼怎麼辦？</a>
    <div id="collapseQuestion2" class="collapse">
      <p>請點擊「忘記密碼」連結，然後輸入您的註冊電子郵件地址。我們將向您發送一封包含重置密碼連結的電子郵件。</p>
    </div>
  </li>
  <li>
    <a data-toggle="collapse" href="#collapseQuestion3">問題3：如何聯絡客服？</a>
    <div id="collapseQuestion3" class="collapse">
      <p>您可以撥打我們的客服熱線：123-456-7890，或者發送電子郵件至 <a href="mailto:service@example.com">service@example.com</a> 與我們聯繫。</p>
    </div>
  </li>
  <li>
    <a data-toggle="collapse" href="#collapseQuestion4">問題4：如何辦理商品退貨？</a>
    <div id="collapseQuestion4" class="collapse">
      <p>如果您希望辦理商品退貨，請按照以下步驟進行：</p>
      <ol>
        <li>聯繫我們的客服團隊，提供您的訂單詳細信息和退貨原因。</li>
        <li>我們的客服人員將指導您填寫退貨申請表格並提供退貨地址。</li>
        <li>將退貨商品妥善包裝好，寄回提供的退貨地址。</li>
        <li>當我們收到退貨商品後，將進行檢查並處理退款程序。</li>
        <li>退款完成後，您將收到通知並在數個工作日內收到退款金額。</li>
      </ol>
      <p>如需進一步協助或有任何問題，請隨時與我們的客服團隊聯繫。</p>
    </div>
  </li>
</ul>`;
        $(".talkstartes").append(html);
                



			} else if ("history" === jsonObj.type) {
                console.log(jsonObj);
                        var html = "";
                        
                        var messages = JSON.parse(jsonObj.message);
                        console.log(messages);
                        for (var i = 0; i < messages.length; i++) {
                            var historyData = JSON.parse(messages[i]);
                            console.log(historyData);
                            var showMsg = historyData.message;
                            if(historyData.sender==5){

                var text=historyData.messageTime;
                var datePart = text.substring(5, 10);
                var timePart = text.substring(11, 16);

              // 格式化成指定的格式
             var formattedText = datePart + "<br>" + timePart;
        
        html += `    <div class="chat-message-left mb-4">
       <div><img src="../lib/img/客服圖.png" class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
       <div class="text-muted small text-nowrap mt-2">${formattedText}</div></div>
       <div class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
       <div class="font-weight-bold mb-1"></div>${historyData.message}</div></div>`;

    }else{
        console.log(historyData.messageTime);
                 var text=historyData.messageTime;
                var datePart = text.substring(5, 10);
                var timePart = text.substring(11, 16);

              // 格式化成指定的格式
             var formattedText = datePart + "<br>" + timePart;
        
        html += `
       
       <div class="chat-message-right mb-4">
       <div><img <img src="data:image/jpeg;base64,`+localStoragePhoto+`" class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
       <div class="text-muted small text-nowrap mt-2">${formattedText}</div></div>
       <div class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
       <div class="font-weight-bold mb-1">`+localStorageNickname+`</div>${historyData.message}</div></div>
       `;
    }
		
						
    };					
                         $(".talkstartes").append(html);
			
				// messagesArea.scrollTop = messagesArea.scrollHeight;
			} else if ("chat" === jsonObj.type) {
				// var li = document.createElement('li');
				// jsonObj.sender === self ? li.className += 'me' : li.className += 'friend';
				// li.innerHTML = jsonObj.message;
				// console.log(li);
				// document.getElementById("area").appendChild(li);
				// messagesArea.scrollTop = messagesArea.scrollHeight;
                var text=jsonObj.messageTime;
                var datePart = text.substring(5, 10);
                var timePart = text.substring(11, 16);

              // 格式化成指定的格式
             var formattedText = datePart + "<br>" + timePart;

                let html = `
       
       <div class="chat-message-left mb-4">
       <div><img src="../lib/img/客服圖.png" class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
       <div class="text-muted small text-nowrap mt-2">${formattedText}</div></div>
       <div class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
       <div class="font-weight-bold mb-1"></div>${jsonObj.message}</div></div>
       `;
             $(".talkstartes").append(html);
           

			} else if ("close" === jsonObj.type) {
				
			}
			
		};

    //     function sendMessage(input_text) {
              
    //        var timestamp = new Date().toISOString();
    //         console.log(timestamp);
    //        var jsonObj = {
    //     "type" : "chat",
    //     "sender" : 1112,
    //     "receiver" : 1,
    //     "message" : input_text,
    //     "messageTime":timestamp
    //     };
    
    // webSocket.send(JSON.stringify(jsonObj));
    
    // }
    




        

		webSocket.onclose = function(event) {
			console.log("Disconnected!");
		};
	}
	
	// function sendMessage(input_text) {
	

	
	// 		var jsonObj = {
	// 			"type" : "chat",
	// 			"sender" : 1111,
	// 			"receiver" :1,
	// 			"message" : input_text 
	// 		};
	// 		webSocket.send(JSON.stringify(jsonObj));
	// }
	
	// 有好友上線或離線就更新列表
	// function refreshFriendList(jsonObj) {
	// 	var friends = jsonObj.users;
	// 	var row = document.getElementById("row");
	// 	row.innerHTML = '';
	// 	for (var i = 0; i < friends.length; i++) {
	// 		if (friends[i] === self) { continue; }
	// 		row.innerHTML +='<div id=' + i + ' class="column" name="friendName" value=' + friends[i] + ' ><h2>' + friends[i] + '</h2></div>';
	// 	}
	// 	// addListener();
	// }
	// 註冊列表點擊事件並抓取好友名字以取得歷史訊息
	// function addListener() {
	// 	var container = document.getElementById("row");
	// 	container.addEventListener("click", function(e) {
	// 		var friend = e.srcElement.textContent;
	// 		updateFriendName(friend);
	// 		var jsonObj = {
	// 				"type" : "history",
	// 				"sender" : 1111,
	// 				"receiver" : 1,
	// 				"message" : ""
	// 			};
	// 		webSocket.send(JSON.stringify(jsonObj));
	// 	});
	// }
	
	function disconnect() {

        var jsonObj = {
					"type" : "leave",
					"sender" :localStorageId,
					"receiver" : 5,
					"message" : "",
                    "messageTime":timestamp
				};
			webSocket.send(JSON.stringify(jsonObj));

		webSocket.close();
		
	}
	
	function updateFriendName(name) {
		statusOutput.innerHTML = name;
	}
</script>
</body>

</html>